<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }

        canvas {
            display: block;
        }
    </style>
    <title>Random Dot Drawer with Dynamic Cells, Grid, Mouse Click Capture, and Pause on Hold</title>
</head>
<body>
    <canvas id="dotCanvas"></canvas>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Get the canvas element
            var canvas = document.getElementById('dotCanvas');
            var ctx = canvas.getContext('2d');

            // Set canvas size
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            // Calculate cell size based on the screen width
            var cellSize = canvas.width / 20;
            
            // Calculate the number of cells in the x and y directions using floor
            var numCellsX = Math.floor(canvas.width / cellSize);
            var numCellsY = Math.floor(canvas.height / cellSize);

            // Array to store the coordinates of all cells
            var allCellCoordinates = [];

            // Fill the array with all cell coordinates
            for (let i = 0; i < numCellsX; i++) {
                for (let j = 0; j < numCellsY; j++) {
                    allCellCoordinates.push({ x: (i + 0.5) * cellSize, y: (j + 0.5) * cellSize });
                }
            }

            // Shuffle the array to randomize the order
            shuffleArray(allCellCoordinates);

            var frame_counter = 0;

            // Variable to store the index of the current dot
            var currentDotIndex = 0;

            // Variable to store the coordinates of the current dot
            var currentDot = {
                x: Math.floor((canvas.width / 2) / cellSize) * cellSize,
                y: Math.floor((canvas.height / 2) / cellSize) * cellSize };

            // Array to store the coordinates of the dots
            var dotCoordinatesArray = [];

            // Variable to store the timestamp when the mouse button is pressed
            var mouseDownTimestamp = 0;

            // Flag to indicate if the app is paused
            var isPaused = false;

            // Function to draw a dot at the next cell
            function update() {
                if (!isPaused && mouseDownTimestamp != 0) {
                    // Pause the app and show all saved dots in green
                    if (Date.now() - mouseDownTimestamp >= 2000) {
                        dotCoordinatesArray.pop(); // Remove the dot that was added when mouse button was pressed
                        console.log("Coordinates popped: ", {tnow:Date.now(), tdwn:mouseDownTimestamp});
                        mouseDownTimestamp = 0;
                        isPaused = true;
                    }
                }
                
                ctx.clearRect(0, 0, canvas.width, canvas.height); // Clear canvas
                
                if (isPaused) {
                    // Draw grid lines in lightgray
                    ctx.beginPath();
                    for (let i = 0; i <= numCellsX; i++) {
                        ctx.moveTo(i * cellSize, 0);
                        ctx.lineTo(i * cellSize, numCellsY * cellSize);
                    }
                    for (let j = 0; j <= numCellsY; j++) {
                        ctx.moveTo(0, j * cellSize);
                        ctx.lineTo(canvas.width, j * cellSize);
                    }
                    ctx.strokeStyle = 'lightgray';
                    ctx.stroke();
                    
                    // Draw stored dots in green
                    ctx.fillStyle = 'green';
                    for (let k = 0; k < dotCoordinatesArray.length; k++) {
                        ctx.beginPath();
                        ctx.arc(dotCoordinatesArray[k].x, dotCoordinatesArray[k].y, 5, 0, 2 * Math.PI);
                        ctx.fill();
                    }
                }
                else if (mouseDownTimestamp == 0){
                    if (frame_counter >= 90) {
                        frame_counter = 0;
                        if (currentDotIndex >= allCellCoordinates.length) {
                            // If all cells have been visited, reset the index and reshuffle the array
                            currentDotIndex = 0;
                            shuffleArray(allCellCoordinates);
                        }
                    
                        currentDot = allCellCoordinates[currentDotIndex];
                        currentDotIndex++;
                    }

                    // Draw the dot
                    ctx.beginPath();
                    ctx.arc(currentDot.x, currentDot.y, 5, 0, 2 * Math.PI);
                    ctx.fillStyle = 'black';
                    ctx.fill();

                    ++frame_counter;
                }

                    // Draw the crosshair at the center of the cell
                let cellCenterX = Math.floor((canvas.width / 2) / cellSize) * cellSize;
                let cellCenterY = Math.floor((canvas.height / 2) / cellSize) * cellSize;

                // Draw the crosshair at the center
                ctx.beginPath();
                ctx.moveTo(cellCenterX, 0);
                ctx.lineTo(cellCenterX, canvas.height);
                ctx.moveTo(0, cellCenterY);
                ctx.lineTo(canvas.width, cellCenterY);
                ctx.strokeStyle = 'red'; // Crosshair color
                ctx.stroke();
            }

            // Event listener for mouse button press
            document.addEventListener('mousedown', function (event) {
                if (isPaused) {
                    isPaused = false;
                    frame_counter = 0;
                }
                else {
                    // Add current dot coordinates to the array
                    dotCoordinatesArray.push({ x: currentDot.x, y: currentDot.y });
                    console.log("Coordinates added: ", { x: currentDot.x, y: currentDot.y });

                    mouseDownTimestamp = Date.now();
                }
            });

            // Event listener for mouse button release
            document.addEventListener('mouseup', function (event) {
                mouseDownTimestamp = 0;
            });

            // Update 30 times per seconds
            setInterval(update, 33);

            // Function to shuffle an array
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    let j = Math.floor(Math.random() * (i + 1));
                    let temp = array[i];
                    array[i] = array[j];
                    array[j] = temp;
                }
            }
        });
    </script>
</body>
</html>
